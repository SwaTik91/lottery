<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Golden Fortune Lottery ‚Äî GitHub Pages</title>
    <!--
      –í–ê–ñ–ù–û: —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –∫–∞–∫ index.html (–∞ –Ω–µ .tsx/.jsx).
    -->
    <!-- Tailwind (CDN build for GitHub Pages) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 UMD + ReactDOM UMD –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ë–ï–ó —Å–±–æ—Ä–∫–∏ –∏ –ë–ï–ó JSX -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Ethers v6 UMD –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–ª–æ–∫—á–µ–π–Ω–∞ -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js"></script>
    <style>
      .gold-pattern { background-image: url('https://www.transparenttextures.com/patterns/gold-scale.png'); }
      .glass { backdrop-filter: blur(10px); }
      /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ ‚Äî –≤–∫–ª—é—á–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª, –Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π */
      html, body { height: 100%; }
    </style>
  </head>
  <body class="min-h-screen bg-gradient-to-b from-yellow-300 via-orange-500 to-red-600 text-white flex flex-col items-center p-6 relative overflow-x-hidden">
    <div class="gold-pattern absolute inset-0 opacity-30 pointer-events-none"></div>

    <div id="root" class="w-full"></div>

    <script type="text/javascript">
      // –ó–¥–µ—Å—å –ù–ï–¢ JSX/TSX. –ò—Å–ø–æ–ª—å–∑—É–µ–º React.createElement, —á—Ç–æ–±—ã –æ–±–æ–π—Ç–∏—Å—å –±–µ–∑ —Ç—Ä–∞–Ω—Å–ø–∏–ª—è—Ü–∏–∏.
      const { useState, useEffect, useMemo } = React;

      // ====== CONFIG (–∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥ —Å–≤–æ—é —Å–µ—Ç—å) ======
      const CONFIG = {
        rpcUrl: "https://rpc.ankr.com/eth",           // <--- –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–µ—Ç—å, –≥–¥–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç
        chainId: 1,                                   // 1=Ethereum mainnet (–∏–∑–º–µ–Ω–∏—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
        explorerBaseUrl: "https://etherscan.io",      // —Å–∫–∞–Ω —Å–µ—Ç–∏
        lotteryAddress: "0xYourLotteryAddressHere",   // <--- –∞–¥—Ä–µ—Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –ª–æ—Ç–µ—Ä–µ–∏
        ticketPriceUSDT: 100,
        goalUSDT: 1_000_000,
      };

      // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è ABI: —Å–æ–±—ã—Ç–∏—è –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
      const LOTTERY_ABI = [
        "event TicketPurchased(address indexed buyer, uint256 idx)",
        "event DrawRequested(uint256 requestId)",
        "event WinnersPicked(address[] winners, uint256[] prizes)"
      ];

      // ====== Utils ======
      function formatUsd(num) {
        return Number(num).toLocaleString(undefined, { maximumFractionDigits: 0 });
      }
      function clampProgress(pool, goal) {
        if (!Number.isFinite(goal) || goal <= 0) return 0;
        const pct = (Number(pool)/Number(goal))*100;
        return Math.max(0, Math.min(100, pct));
      }
      function isAddr(a){ try { return ethers.isAddress(a); } catch(e){ return false; } }

      // ====== BADGES ======
      function Badges({ address, explorerBaseUrl }) {
        const addrOk = address && isAddr(address);
        const addrUrl = addrOk ? `${explorerBaseUrl}/address/${address}` : "#";
        return (
          React.createElement('div', { className: "mt-6 flex flex-wrap gap-3" },
            React.createElement('a', { href: addrUrl, target: "_blank", rel: "noreferrer",
              className: "inline-flex items-center gap-2 px-3 py-2 rounded-full bg-white/15 glass border border-yellow-300/60 text-sm font-semibold shadow-lg" },
              React.createElement('svg', { xmlns:"http://www.w3.org/2000/svg", className:"w-4 h-4", viewBox:"0 0 24 24", fill:"none", stroke:"currentColor", strokeWidth:"2"},
                React.createElement('path', { d:"M12 2l3 7 7 1-5 5 1 7-6-3-6 3 1-7-5-5 7-1z"})
              ),
              "–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ Etherscan"
            ),
            React.createElement('a', { href: "https://chain.link/vrf", target: "_blank", rel: "noreferrer",
              className: "inline-flex items-center gap-2 px-3 py-2 rounded-full bg-white/15 glass border border-blue-200/60 text-sm font-semibold shadow-lg" },
              React.createElement('svg', { xmlns:"http://www.w3.org/2000/svg", className:"w-4 h-4", viewBox:"0 0 24 24", fill:"none", stroke:"currentColor", strokeWidth:"2"},
                React.createElement('circle', { cx:"12", cy:"12", r:"9"})
              ),
              "Powered by Chainlink VRF"
            )
          )
        );
      }

      // ====== RECENT EVENTS (—á–∏—Ç–∫–∞ –∏–≤–µ–Ω—Ç–æ–≤) ======
      function useRecentEvents(provider, contractAddress, abi) {
        const [events, setEvents] = useState([]);
        const iface = useMemo(() => new ethers.Interface(abi), [abi]);

        useEffect(() => {
          if (!provider || !isAddr(contractAddress)) return;
          let cancelled = false;

          async function fetchLogs() {
            try {
              const latest = await provider.getBlockNumber();
              const LOOKBACK = 50000; // –æ–∫–Ω–æ –≤ –±–ª–æ–∫–∞—Ö; –ø–æ–¥—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥ —Å–µ—Ç—å
              const fromBlock = Math.max(latest - LOOKBACK, 0);
              const filter = { address: contractAddress, fromBlock, toBlock: latest };
              const logs = await provider.getLogs(filter);
              const parsed = logs.map(l => {
                try {
                  const evt = iface.parseLog(l);
                  return { name: evt?.name || "Unknown", args: evt?.args || [], txHash: l.transactionHash, blockNumber: l.blockNumber };
                } catch (e) { return null; }
              }).filter(Boolean).sort((a,b) => b.blockNumber - a.blockNumber).slice(0, 12);
              if (!cancelled) setEvents(parsed);
            } catch (e) {
              console.error('events fetch error', e);
            }
          }

          fetchLogs();
          const id = setInterval(fetchLogs, 15000);
          return () => { cancelled = true; clearInterval(id); };
        }, [provider, contractAddress, iface]);

        return events;
      }

      function App() {
        const [participants, setParticipants] = useState(4321);
        const [pool, setPool] = useState(432100);

        // Provider (HTTP ‚Äî —Å–æ–≤–º–µ—Å—Ç–∏–º —Å GitHub Pages)
        const provider = useMemo(() => new ethers.JsonRpcProvider(CONFIG.rpcUrl, CONFIG.chainId), []);
        const events = useRecentEvents(provider, CONFIG.lotteryAddress, LOTTERY_ABI);

        // –ü—Ä–æ—Å—Ç–∞—è –¥–µ–º–æ-–∏–º–∏—Ç–∞—Ü–∏—è —Ä–æ—Å—Ç–∞ –ø—É–ª–∞/—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (—Ç–æ–ª—å–∫–æ UI)
        useEffect(() => {
          const t = setInterval(() => {
            setPool(p => (p < CONFIG.goalUSDT ? p + Math.floor(Math.random()*3000) : p));
            setParticipants(c => (c < 10000 ? c + Math.floor(Math.random()*10) : c));
          }, 2000);
          return () => clearInterval(t);
        }, []);

        const progress = clampProgress(pool, CONFIG.goalUSDT);
        const explorerAddr = `${CONFIG.explorerBaseUrl}/address/${CONFIG.lotteryAddress}`;

        return (
          React.createElement('div', { className: "w-full flex flex-col items-center" },
            React.createElement('h1', { className: "text-6xl font-extrabold drop-shadow-2xl mb-8 text-yellow-200 mt-6" }, 'üëë Golden Fortune Lottery üíé'),

            React.createElement('div', { className: "glass bg-white/20 border-2 border-yellow-400 rounded-3xl shadow-2xl max-w-3xl w-full p-8" },
              React.createElement('div', { className: "w-full" },
                React.createElement('div', { className: "flex justify-between items-center mb-2" },
                  React.createElement('span', { className: "text-xl font-bold flex items-center gap-2" },
                    React.createElement('span', { className: "inline-block w-6 h-6" }, ''), '–ü—Ä–∏–∑–æ–≤–æ–π –ø—É–ª'
                  ),
                  React.createElement('span', { className: "text-xl font-bold" }, `$${formatUsd(pool)} / $${formatUsd(CONFIG.goalUSDT)}`)
                ),
                React.createElement('div', { className: "w-full h-5 bg-white/40 rounded-full overflow-hidden" },
                  React.createElement('div', { style: { width: progress + '%' }, className: "h-full bg-gradient-to-r from-yellow-300 via-orange-400 to-red-500" })
                )
              ),

              React.createElement('div', { className: "mt-6 grid grid-cols-1 md:grid-cols-3 gap-6 text-center" },
                React.createElement('div', { className: "flex flex-col items-center" },
                  React.createElement('div', { className: "h-10" }, ''),
                  React.createElement('span', { className: "font-bold text-2xl" }, participants),
                  React.createElement('span', { className: "text-sm" }, '–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤')
                ),
                React.createElement('div', { className: "flex flex-col items-center" },
                  React.createElement('div', { className: "h-10" }, ''),
                  React.createElement('span', { className: "font-bold text-2xl" }, `${CONFIG.ticketPriceUSDT} USDT`),
                  React.createElement('span', { className: "text-sm" }, '–¶–µ–Ω–∞ –±–∏–ª–µ—Ç–∞')
                ),
                React.createElement('div', { className: "flex flex-col items-center" },
                  React.createElement('div', { className: "h-10" }, ''),
                  React.createElement('span', { className: "font-bold text-2xl" }, '$1,000,000'),
                  React.createElement('span', { className: "text-sm" }, '–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–∑')
                )
              ),

              React.createElement(Badges, { address: CONFIG.lotteryAddress, explorerBaseUrl: CONFIG.explorerBaseUrl }),

              React.createElement('div', { className: "mt-8" },
                React.createElement('a', { href: explorerAddr, target: "_blank", rel: "noreferrer",
                  className: "inline-flex items-center gap-2 px-4 py-3 rounded-2xl bg-gradient-to-r from-yellow-300 via-orange-400 to-red-500 font-semibold shadow-lg" },
                  '–°–º–∞—Ä—Ç‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç'
                ),
                React.createElement('a', { href: '#', className: "ml-3 inline-flex items-center gap-2 px-4 py-3 rounded-2xl bg-white/10 hover:bg-white/20 transition font-semibold" }, '–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (GitHub)')
              ),

              React.createElement('p', { className: "mt-8 text-center max-w-3xl text-lg text-yellow-100" },
                '–ö–æ–≥–¥–∞ –ø—É–ª –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç $1,000,000 USDT, —Å–∏—Å—Ç–µ–º–∞ —Å–ª—É—á–∞–π–Ω–æ –≤—ã–±–µ—Ä–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —á–µ—Ä–µ–∑ Chainlink VRF –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç –ø—Ä–∏–∑.'
              )
            ),

            // ===== RECENT TRANSACTIONS =====
            React.createElement('div', { className: "mt-12 glass bg-white/15 border border-yellow-400/60 rounded-3xl shadow-xl max-w-4xl w-full p-6" },
              React.createElement('div', { className: "flex items-center gap-3 mb-4" },
                React.createElement('span', { className: "font-extrabold text-2xl text-yellow-100" }, '–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏')
              ),
              events.length === 0 ? React.createElement('div', { className: "text-yellow-50/80" }, '–ü–æ–∫–∞ –Ω–µ—Ç –Ω–µ–¥–∞–≤–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π –∏–ª–∏ RPC –æ–≥—Ä–∞–Ω–∏—á–µ–Ω.') :
                React.createElement('ul', { className: "divide-y divide-white/10" },
                  events.map((e, i) => React.createElement('li', { key: i, className: "py-3" },
                    React.createElement('div', { className: "flex flex-col md:flex-row md:items-center md:justify-between gap-2" },
                      React.createElement('div', { className: "font-semibold" }, e.name),
                      React.createElement('div', { className: "text-sm text-yellow-50/80" }, `–ë–ª–æ–∫ #${e.blockNumber}`),
                      React.createElement('a', { className: "text-sm underline", target: "_blank", rel: "noreferrer",
                        href: `${CONFIG.explorerBaseUrl}/tx/${e.txHash}` }, '–û—Ç–∫—Ä—ã—Ç—å –≤ —Å–∫–∞–Ω–µ')
                    ),
                    e.name === 'TicketPurchased' && React.createElement('div', { className: "text-sm text-yellow-50/90" }, `buyer: ${e.args[0]}`),
                    e.name === 'WinnersPicked' && React.createElement('div', { className: "text-sm text-yellow-50/90" }, `winners: ${e.args[0].length}`)
                  ))
                )
            ),

            // ===== WHY FAIR =====
            React.createElement('div', { className: "mt-10 w-full max-w-4xl" },
              React.createElement('div', { className: "glass bg-white/15 border border-yellow-400/60 rounded-3xl shadow-xl p-6" },
                React.createElement('h2', { className: "text-2xl font-extrabold text-yellow-100 mb-3" }, '–ü–æ—á–µ–º—É —ç—Ç–æ —á–µ—Å—Ç–Ω–æ'),
                React.createElement('ul', { className: "grid md:grid-cols-2 gap-3 text-yellow-50/90 list-disc list-inside" },
                  React.createElement('li', null, React.createElement('span', { className: "font-semibold" }, '–ü—Ä–∞–≤–∏–ª–∞ –≤ –∫–æ–¥–µ. '), '–¶–µ–Ω–∞ –±–∏–ª–µ—Ç–∞, –∫–æ–º–∏—Å—Å–∏—è 5% –∏ –ø–æ—Ä–æ–≥ $1,000,000 USDT –∑–∞—à–∏—Ç—ã –≤ —Å–º–∞—Ä—Ç‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç.'),
                  React.createElement('li', null, React.createElement('span', { className: "font-semibold" }, '–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞. '), '–ë–∞–ª–∞–Ω—Å –∏ –ø–µ—Ä–µ–≤–æ–¥—ã –≤–∏–¥–Ω—ã –≤ –±–ª–æ–∫—á–µ–π–Ω–µ.'),
                  React.createElement('li', null, React.createElement('span', { className: "font-semibold" }, '–°–ª—É—á–∞–π–Ω–æ—Å—Ç—å –æ—Ç –æ—Ä–∞–∫—É–ª–∞. '), 'Chainlink VRF ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º–∞—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å.'),
                  React.createElement('li', null, React.createElement('span', { className: "font-semibold" }, '–ê–≤—Ç–æ–≤—ã–ø–ª–∞—Ç–∞. '), '–ü—Ä–∏–∑ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.')
                )
              )
            ),

            React.createElement('div', { className: "h-12" })
          )
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(App));

      // ===== Inline tests (UI helpers) ===== (–ù–ï –º–µ–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ; –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –Ω–∏–∂–µ)
      console.assert(clampProgress(0, 1000000) === 0, 'progress 0%');
      console.assert(clampProgress(1000000, 1000000) === 100, 'progress 100%');
      console.assert(clampProgress(1500000, 1000000) === 100, 'progress clamp > 100');
      console.assert(clampProgress(-100, 1000000) === 0, 'progress clamp < 0');
      // –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
      console.assert(clampProgress(500000, 1000000) === 50, 'progress mid 50%');
      console.assert(clampProgress(0, 0) === 0, 'progress goal 0 => 0');
      console.assert(formatUsd(1234567) === '1,234,567' || formatUsd(1234567) === '1.234.567', 'formatUsd grouping');
      console.assert(isAddr('0x0000000000000000000000000000000000000000') === true, 'isAddr true for zero address');
      console.assert(isAddr('0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045') === true, 'isAddr true for checksum');
      console.assert(isAddr('not-an-address') === false, 'isAddr false for garbage');
    </script>
  </body>
</html>
